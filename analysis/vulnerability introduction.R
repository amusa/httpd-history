library(RODBC)
library(lattice)
conn <- odbcConnect("httpdhistory", uid="root", pwd="root", case="tolower")

repolog <- sqlQuery(conn, "SELECT * FROM VulnIntroAll")

association <- function(vulnerable, neutral){
  cat("Vuln. Mean:\t",mean(vulnerable, na.rm=TRUE),"\n")
  cat("Neutral Mean:\t",mean(neutral, na.rm=TRUE),"\n")
  wilcox.test(vulnerable,neutral)
}

###################
#### VCC Files ####
###################

#### TotalChurn####
# Do VCCs have more total churn?
vulnerable <- repolog$TotalChurn[repolog$VulnIntro=="Yes"]
neutral <- repolog$TotalChurn[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

#### RelChurn #####
# Do VCCs have more relative churn?
vulnerable <- repolog$RelativeChurn[repolog$VulnIntro=="Yes"]
neutral <- repolog$RelativeChurn[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### PIC ########
# Does the PIC differ between VCC and non-VCCs?
vulnerable <- repolog$PercIntChurn[repolog$VulnIntro=="Yes"]
neutral <- repolog$PercIntChurn[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### NAA ########
# Does the NAA differ between VCC and non-VCCs?
vulnerable <- repolog$NumAuthorsAffected[repolog$VulnIntro=="Yes"]
neutral <- repolog$NumAuthorsAffected[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### NEA ########
# Does the NEA differ between VCC and non-VCCs?
vulnerable <- repolog$NumEffectiveAuthors[repolog$VulnIntro=="Yes"]
neutral <- repolog$NumEffectiveAuthors[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

####################
### VCCs Grouped ###
####################

repolog <- sqlQuery(conn, "SELECT * FROM VulnIntroByCommit")

#### TotalChurn####
# Do VCCs have more total churn?
vulnerable <- repolog$TotalChurn[repolog$VulnIntro=="Yes"]
neutral <- repolog$TotalChurn[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

#### AvgRelChurn #####
# Do VCCs have more relative churn?
vulnerable <- repolog$AvgRelChurn[repolog$VulnIntro=="Yes"]
neutral <- repolog$AvgRelChurn[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### AvgPIC ########
# Does the PIC differ between VCC and non-VCCs?
vulnerable <- repolog$AvgPIC[repolog$VulnIntro=="Yes"]
neutral <- repolog$AvgPIC[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### AvgNAA ########
# Does the NAA differ between VCC and non-VCCs?
vulnerable <- repolog$AvgNAA[repolog$VulnIntro=="Yes"]
neutral <- repolog$AvgNAA[repolog$VulnIntro=="No"]
association(vulnerable, neutral)

###### AvgNEA ########
# Does the NEA differ between VCC and non-VCCs?
vulnerable <- repolog$AvgNEA[repolog$VulnIntro=="Yes"]
neutral <- repolog$AvgNEA[repolog$VulnIntro=="No"]
association(vulnerable, neutral)


#odbcClose(conn)
#rm(conn)